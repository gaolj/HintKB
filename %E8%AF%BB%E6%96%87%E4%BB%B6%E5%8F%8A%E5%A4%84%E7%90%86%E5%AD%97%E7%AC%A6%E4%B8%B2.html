<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>内部资料 : 读文件及处理字符串</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            内部资料 : 读文件及处理字符串
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on 2013-08-06 by <font color="#0050B2">gaolj</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <h1 id="id-读文件及处理字符串-文件md5.txt内容：">文件md5.txt内容：</h1><p>GameInfo.xml=934D8267AF6E5785BEB2AAD6A3D698CC<br />GameList3.xml=ADF338D163CA8F8DF8D04380D787F400<br />GameList4.xml=9BFAB2A5679725BE0F80E7497639AA5E<br />GameList5.xml=DD153AB5BD7BFDEB350510FA6DD5C7EF</p><h1 id="id-读文件及处理字符串-代码功能描述：">代码功能描述：</h1><p>把md5.txt文件中的每一行的‘=’左右两边的字符串拆分成值对，再放入std::map中</p><h1 id="id-读文件及处理字符串-复杂的代码：">复杂的代码：</h1><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: cpp; gutter: false" style="font-size:12px;">void ReloadMd5File()
{
	HANDLE hfile     = 0;
	DWORD dwFileSize = 0;
	DWORD dwReadSize = 0;
	char  *token	 = NULL;
	char  *lpFileBuf = NULL;
	char  *szfilename= NULL;
	char  *szmd5value= NULL;
	do 
	{
		hfile = CreateFile(&quot;md5.txt&quot;, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);
		if (hfile == INVALID_HANDLE_VALUE)    
			break;
		dwFileSize = GetFileSize(hfile, NULL);
		if (dwFileSize == INVALID_FILE_SIZE || dwFileSize == 0)
			break;
		lpFileBuf = new char[dwFileSize];
		if (!ReadFile(hfile, lpFileBuf, dwFileSize, &amp;dwReadSize, NULL))
			break;
		token = strtok(lpFileBuf,&quot;\r\n&quot;);
		while(token != NULL) 
		{
			szmd5value = strrchr(token,&#39;=&#39;);
			if (szmd5value) 
			{
				szmd5value[0] = &#39;\0&#39;;
				szmd5value++;
				szfilename = token;
				m_mapDtFilesMd5.insert(pair&lt;string,string&gt;(szfilename,szmd5value));
			}
			token = strtok(NULL,&quot;\r\n&quot;);   
		};	
	} while (FALSE);
	if (hfile)     CloseHandle(hfile);
	if (lpFileBuf) delete lpFileBuf;
}</pre>
</div></div><h1 id="id-读文件及处理字符串-简洁的代码：">简洁的代码：</h1><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="theme: Confluence; brush: cpp; gutter: false" style="font-size:12px;">void ReloadMd5File()
{
	std::ifstream ifs;
	ifs.open(szFileName);
	if (!ifs.is_open())
		return;
	while (!ifs.eof())
	{
		string line;
		ifs &gt;&gt; line;
		int index = line.find_first_of(&#39;=&#39;);
		m_mapDtFilesMd5.insert(make_pair(line.substr(0, index), line.substr(index + 1, line.length() - index)));
	}
}</pre>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://10.30.1.104:8090/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on 2015-10-30 12:39:20</small></p>
            </div>
        </div>     </body>
</html>
